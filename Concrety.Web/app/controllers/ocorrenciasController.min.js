"use strict";app.controller("ocorrenciasController",function(n,t,i,r,u,f,e,o,s,h){function c(){n.salvoComSucesso=!0;n.mensagem=n.isNew()?"Ocorrência criada com sucesso.":"Ocorrência atualizada com sucesso.";t(function(){r.close(n.ocorrencia)},1e3)}function l(t){var u=[],r,i;for(r in t.data.modelState)for(i=0;i<t.data.modelState[r].length;i++)u.push(t.data.modelState[r][i]);n.mensagem=u.join(" ")}n.patologias=[];n.ocorrencia=u;n.salvoComSucesso=!1;n.mensagem="";n.isNew=function(){return!n.ocorrencia.id};n.dropDownPatologiasOptions=[];n.dropDownStatusOptions={dataTextField:"nome",dataValueField:"id",dataSource:new kendo.data.DataSource({type:"json",transport:{read:function(n){f.obterPossiveisStatus().then(function(t){n.success(t.data)})}}})};var a=n.ocorrencia.itemVerificacao.idItemVerificacaoServico;e.obter(a).then(function(t){n.patologias=t.data;n.dropDownPatologiasOptions={dataTextField:"nome",dataValueField:"id",optionLabel:"Selecione...",dataSource:new kendo.data.DataSource({type:"json",transport:{read:function(t){t.success(n.patologias)}}})}});n.$watch("ocorrencia.idPatologia",function(t){if(t)for(var i=0;i<n.patologias.length;i++)if(n.patologias[i].id==n.ocorrencia.idPatologia){n.ocorrencia.patologia=n.patologias[i];break}});n.fechar=function(){r.dismiss()};n.salvar=function(){n.isNew()?f.create(n.ocorrencia).then(c,l):f.update(n.ocorrencia).then(c,l)};n.anexoSelecionado=function(t){angular.forEach(t.files,function(i){/^(.bmp|.gif|.jpg|.jpeg|.png|.tiff)$/i.test(i.extension)||(n.mensagem="Por favor, selecione apenas anexos de imagem (bmp, gif, jpg, jpeg, png ou tiff)",t.preventDefault())})};n.uploadIniciado=function(n){var i=o.apiServiceBaseUri+"api/anexos/create",t;n.sender.options.async.saveUrl=i+"?idObra="+h.empreendimentoAtual.id;t=n.XMLHttpRequest;t&&t.addEventListener("readystatechange",function(){if(t.readyState==1){var n=s.get("authorizationData");n&&t.setRequestHeader("Authorization","Bearer "+n.token)}})};n.uploadConcluido=function(t){t.operation=="upload"&&(n.ocorrencia.anexos.push({idOcorrencia:n.ocorrencia.id,anexo:t.response,idAnexo:t.response.id}),n.$apply())};n.excluirAnexo=function(t){n.ocorrencia.anexos.remove(t);t.anexo.idObra=h.empreendimentoAtual.id;f.removerAnexo(t)};n.abrirModalNorma=function(){var t=i.open({templateUrl:"/app/partials/modalNorma.html",controller:"modalNormasController",size:"lg",resolve:{servico:function(){return n.ocorrencia.patologia.solucoes[0]}}})}});
//# sourceMappingURL=ocorrenciasController.min.js.map
