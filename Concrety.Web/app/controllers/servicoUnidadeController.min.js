"use strict";app.controller("servicoUnidadeController",function(n,t,i,r,u,f){function o(n){n.preventDefault();var t=this.dataItem(angular.element(n.currentTarget).closest("tr")),r=i.open({templateUrl:"/app/partials/modalOcorrencia.html?v="+new Date,controller:"ocorrenciasController",size:"lg",resolve:{ocorrencia:function(){return t}}});r.result.then(function(){angular.element("#grid_ocorrencias").data("kendoGrid").dataSource.read()})}function e(){n.servicoUnidade.dataInicio=="0001-01-01T00:00:00"&&(n.servicoUnidade.dataInicio="");n.servicoUnidade.dataFim=="0001-01-01T00:00:00"&&(n.servicoUnidade.dataFim="")}function s(n){return{id:0,descricao:"",dataAbertura:new Date,dataConclusao:"",status:10,itemVerificacao:n,idItemVerificacaoUnidade:n.id,anexos:[]}}function h(){var t=[{command:[{text:"Editar",click:o}],title:"Ações"},{field:"nomeFichaVerificacaoServico",title:"FVS"},{field:"nomeItemVerificacaoServico",title:"Item"},{field:"dataAbertura",title:"Data Abertura",format:"{0:dd/MM/yyyy}"},{field:"dataConclusao",title:"Data Conclusão",format:"{0:dd/MM/yyyy}"},{field:"descricaoStatus",title:"Status"},{field:"nomePatologia",title:"Patologia"}],i=kendo.data.Model.define({id:"id",fields:{id:{type:"number"},nomeFichaVerificacaoServico:{type:"string"},nomeItemVerificacaoServico:{type:"string"},dataAbertura:{type:"date"},dataConclusao:{type:"date"},descricaoStatus:{type:"string"},nomePatologia:{type:"string"}}}),r=new kendo.data.DataSource({type:"json",transport:{read:function(t){f.obterDoServicoUnidade(n.servicoUnidade.id).then(function(n){t.success(n.data)})}},pageSize:10,schema:{model:i}});n.ocorrenciasGridOptions={dataSource:r,sortable:!0,pageable:{refresh:!0},filterable:{extra:!1},columns:t}}n.servicoUnidade=[];n.ocorrenciasGridOptions=[];n.salvoComSucesso=!1;n.mensagem="";u.obter(n.unidadeSelecionada,n.servico.id).then(function(t){n.servicoUnidade=t.data;e();h()});n.abrirModalNorma=function(){var t=i.open({templateUrl:"/app/partials/modalNorma.html",controller:"modalNormasController",size:"lg",resolve:{servico:function(){return n.servico}}})};n.novaOcorrencia=function(n){var t=i.open({templateUrl:"/app/partials/modalOcorrencia.html?v="+new Date,controller:"ocorrenciasController",size:"lg",resolve:{ocorrencia:function(){return s(n)}}});t.result.then(function(){n.quantidadeOcorrencias++;angular.element("#grid_ocorrencias").data("kendoGrid").dataSource.read()})};n.salvar=function(){n.servicoUnidade.dataInicio==""&&(n.servicoUnidade.dataInicio="0001-01-01T00:00:00");n.servicoUnidade.dataFim==""&&(n.servicoUnidade.dataFim="0001-01-01T00:00:00");u.salvar(n.servicoUnidade).then(function(i){e();n.salvoComSucesso=!0;n.mensagem="Alterações salvas com sucesso.";i.data.servicoConcluido&&t.$broadcast("servicoConcluidoEvent",[])},function(t){var r,u,i;e();r=[];for(u in t.data.modelState)for(i=0;i<t.data.modelState[u].length;i++)r.push(t.data.modelState[u][i]);n.mensagem=r.join(" ")})};n.dropDownStatusOptions={dataTextField:"nome",dataValueField:"id",dataSource:new kendo.data.DataSource({type:"json",transport:{read:function(n){r.obterPossiveisStatus().then(function(t){n.success(t.data)})}}})};n.dropDownResultadoOptions={dataTextField:"nome",dataValueField:"id",optionLabel:"Selecione...",dataSource:new kendo.data.DataSource({type:"json",transport:{read:function(n){r.obterPossiveisResultados().then(function(t){n.success(t.data)})}}})};n.open=function(t,i){t.preventDefault();t.stopPropagation();n.closeAllDatePickers();i.opened=!0};n.closeAllDatePickers=function(){n.servicoUnidade.dataInicio.opened=!1;n.servicoUnidade.dataFim.opened=!1}});
//# sourceMappingURL=servicoUnidadeController.min.js.map
